{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extrastyle %}
<style>
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .stat-card h3 {
        margin: 0 0 10px 0;
        color: #666;
        font-size: 14px;
        font-weight: normal;
    }

    .stat-card .number {
        font-size: 32px;
        font-weight: bold;
        color: #417690;
    }

    .stat-card.success .number {
        color: #28a745;
    }

    .stat-card.warning .number {
        color: #ffc107;
    }

    .stat-card.info .number {
        color: #17a2b8;
    }

    .notification-form {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 30px;
    }

    .notification-form h2 {
        margin-top: 0;
        color: #417690;
        border-bottom: 2px solid #417690;
        padding-bottom: 10px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #333;
    }

    .form-group input[type="text"],
    .form-group textarea,
    .form-group input[type="datetime-local"] {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }

    .form-group textarea {
        min-height: 100px;
        resize: vertical;
    }

    .checkbox-group {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
    }

    .checkbox-group label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: normal;
    }

    .btn-send {
        background: #417690;
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 4px;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.3s;
    }

    .btn-send:hover {
        background: #2e5568;
    }

    .recent-table {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
    }

    .recent-table h2 {
        margin-top: 0;
        color: #417690;
        border-bottom: 2px solid #417690;
        padding-bottom: 10px;
    }

    .recent-table table {
        width: 100%;
        border-collapse: collapse;
    }

    .recent-table th,
    .recent-table td {
        padding: 12px;
        text-align: right;
        border-bottom: 1px solid #eee;
    }

    .recent-table th {
        background: #f8f9fa;
        font-weight: bold;
        color: #333;
    }

    .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
    }

    .badge-success {
        background: #d4edda;
        color: #155724;
    }

    .badge-danger {
        background: #f8d7da;
        color: #721c24;
    }

    .badge-warning {
        background: #fff3cd;
        color: #856404;
    }

    .btn-small {
        padding: 6px 12px;
        font-size: 12px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .btn-small:hover {
        background: #218838;
    }
</style>
{% endblock %}

{% block content %}
<div id="content-main">
    <h1>ğŸ”” {{ title }}</h1>

    {% if messages %}
    <div class="messagelist">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
    <div class="stats-grid">
        <div class="stat-card info">
            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</h3>
            <div class="number">{{ total_notifications }}</div>
        </div>

        <div class="stat-card warning">
            <h3>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©</h3>
            <div class="number">{{ unread_notifications }}</div>
        </div>

        <div class="stat-card">
            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©</h3>
            <div class="number">{{ total_emails }}</div>
        </div>

        <div class="stat-card success">
            <h3>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª Ø§Ù„Ù†Ø§Ø¬Ø­Ø©</h3>
            <div class="number">{{ successful_emails }}</div>
        </div>

        <div class="stat-card warning">
            <h3>Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</h3>
            <div class="number">{{ pending_updates }}</div>
        </div>

        <div class="stat-card info">
            <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡</h3>
            <div class="number">{{ managers_count }}</div>
        </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯ -->
    <div class="notification-form">
        <h2>ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯</h2>

        <form method="post">
            {% csrf_token %}

            <div class="form-group">
                <label for="title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± *</label>
                <input type="text" id="title" name="title" required placeholder="Ù…Ø«Ø§Ù„: ØªØ­Ø¯ÙŠØ« Ù…Ù‡Ù… Ù„Ù„Ù†Ø¸Ø§Ù…">
            </div>

            <div class="form-group">
                <label for="message">Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± *</label>
                <textarea id="message" name="message" required placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù‡Ù†Ø§..."></textarea>
            </div>

            <div class="form-group">
                <label for="scheduled_time">Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„ *</label>
                <input type="datetime-local" id="scheduled_time" name="scheduled_time" required>
            </div>

            <div class="checkbox-group">
                <label>
                    <input type="checkbox" name="send_email" checked>
                    Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„
                </label>

                <label>
                    <input type="checkbox" name="send_notification" checked>
                    Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø®Ù„ÙŠ
                </label>

                <label>
                    <input type="checkbox" name="send_now" checked>
                    Ø¥Ø±Ø³Ø§Ù„ ÙÙˆØ±Ø§Ù‹
                </label>
            </div>

            <button type="submit" class="btn-send">
                ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø¯Ø±Ø§Ø¡
            </button>
        </form>
    </div>

    <!-- Ø¢Ø®Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© -->
    <div class="recent-table">
        <h2>ğŸ“‹ Ø¢Ø®Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h2>

        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                    <th>Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                </tr>
            </thead>
            <tbody>
                {% for update in recent_updates %}
                <tr>
                    <td><strong>{{ update.title }}</strong></td>
                    <td>{{ update.scheduled_time|date:"Y-m-d H:i" }}</td>
                    <td>{{ update.created_at|date:"Y-m-d H:i" }}</td>
                    <td>
                        {% if update.is_sent %}
                        <span class="badge badge-success">âœ“ ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</span>
                        {% else %}
                        <span class="badge badge-warning">â³ Ù…Ø¹Ù„Ù‚</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if not update.is_sent %}
                        <form method="post" action="{% url 'admin_send_notification_now' update.id %}"
                            style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn-small">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¢Ù†</button>
                        </form>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="text-align: center; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Ø¢Ø®Ø± Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª -->
    <div class="recent-table">
        <h2>ğŸ“§ Ø¢Ø®Ø± Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©</h2>

        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                    <th>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</th>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                </tr>
            </thead>
            <tbody>
                {% for email in recent_emails %}
                <tr>
                    <td>{{ email.recipient }}</td>
                    <td><span class="badge badge-warning">{{ email.get_email_type_display }}</span></td>
                    <td>{{ email.subject|truncatewords:8 }}</td>
                    <td>{{ email.sent_at|date:"Y-m-d H:i" }}</td>
                    <td>
                        {% if email.is_sent %}
                        <span class="badge badge-success">âœ“ Ù†Ø¬Ø­</span>
                        {% else %}
                        <span class="badge badge-danger">âœ— ÙØ´Ù„</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="text-align: center; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}